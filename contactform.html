<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contact Quote Form</title>

<!-- EmailJS CDN -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<!-- Firebase OTP Scripts -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

<style>
/* YOUR SAME CSS — NO CHANGE */
body {
    margin: 0;
    background: linear-gradient(to bottom right, #eef2ff, #e0e7ff);
    font-family: Arial, sans-serif;
}

/* Modal Overlay */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    display: none;
    justify-content: center;
    align-items: center;
    padding: 20px;
    z-index: 100;
}

/* Modal Box */
.modal-box {
    background: #fff;
    border-radius: 20px;
    width: 100%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}

/* Close Button */
.close-btn {
    position: absolute;
    right: 20px;
    top: 20px;
    font-size: 26px;
    color: #ddd;
    cursor: pointer;
    transition: 0.2s;
}
.close-btn:hover { color: #fff; }

.form-container { padding: 30px; }

label {
    display: block;
    margin-bottom: 6px;
    font-weight: bold;
    color: #374151;
}

input, select, textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    margin-bottom: 16px;
    font-size: 15px;
}

textarea {
    height: 120px;
    resize: none;
}

.otp-row {
    display: flex;
    gap: 10px;
}

.otp-btn {
    background: #2563eb;
    color: #fff;
    padding: 12px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 15px;
}

.otp-btn:hover {
    background: #1e40af;
}

.timer-text {
    font-size: 14px;
    color: #e11d48;
    margin-top: -10px;
    margin-bottom: 10px;
    font-weight: bold;
}

.resend-btn {
    display: none;
    background: #16a34a;
    color: white;
    padding: 10px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
}

.submit-btn {
    background: #4f46e5;
    color: #fff;
    padding: 14px;
    border-radius: 10px;
    border: none;
    width: 100%;
    font-size: 18px;
    cursor: pointer;
}
.submit-btn:hover { background: #4338ca; }

.success-box {
    padding: 40px;
    text-align: center;
    display: none;
}
.success-box h2 { font-size: 28px; color: #333; }
</style>
</head>

<body>

<!-- Modal -->
<div class="modal-overlay" id="contactModal">
    <div class="modal-box">

        <div class="close-btn" onclick="closeModal()">×</div>

        <div class="success-box" id="successBox">
            <h2>✔ Message Sent Successfully!</h2>
            <p>Thank you for contacting us!</p>
        </div>

        <!-- Form -->
        <div id="formBox">
            <div class="modal-header">
                <h2>Get a Quote</h2>
                <p>Fill in the details and we'll get back to you</p>
            </div>

            <div class="form-container">
                <form id="quoteForm">

                    <label>Full Name *</label>
                    <input type="text" name="name" required>

                    <label>Email *</label>
                    <input type="email" name="email" required>

                    <label>Mobile *</label>
                    <div class="otp-row">
                        <input type="tel" id="mobile" name="mobile" required placeholder="Enter mobile number">
                        <button type="button" class="otp-btn" id="sendOtpBtn" onclick="sendOTP()">Send OTP</button>
                    </div>

                    <div id="recaptcha-container"></div>

                    <p id="timer" class="timer-text"></p>

                    <button type="button" id="resendOtpBtn" class="resend-btn" onclick="resendOTP()">Resend OTP</button>

                    <label>Enter OTP</label>
                    <div class="otp-row">
                        <input type="text" id="otpInput" placeholder="Enter OTP">
                        <button type="button" class="otp-btn" onclick="verifyOTP()">Verify</button>
                    </div>

                    <p id="otpStatus" style="color:green; font-weight:bold;"></p>

                    <label>Company Name *</label>
                    <input type="text" name="company" required>

                    <label>Choose Service *</label>
                    <select name="service" required>
                        <option value="">Select a service...</option>
                        <option>IT Support</option>
                        <option>Web Services</option>
                        <option>Web Application</option>
                        <option>Android and ios App</option>
                        <option>Digital Marketing</option>
                        <option>Email Solutions</option>
                    </select>

                    <label>Choose Multiple Services (Optional)</label>
                    <select name="services_multiple" multiple size="4">
                        <option>IT Support</option>
                        <option>Web Services</option>
                        <option>Web Application</option>
                        <option>Android and ios App</option>
                        <option>Digital Marketing</option>
                        <option>Email Solutions</option>
                    </select>

                    <label>Message</label>
                    <textarea name="comment"></textarea>

                    <button type="submit" class="submit-btn" id="submitBtn" disabled>Submit</button>

                </form>
            </div>

        </div>

    </div>
</div>

<script>
/* ------------------ FIREBASE CONFIG ------------------ */
var firebaseConfig = {
    apiKey: "AIzaSyBNk1i_JgZShUcHqA33Vju2JPxIhTd5CEA",
    authDomain: "niyan-it-solutions.firebaseapp.com",
    projectId: "niyan-it-solutions",
    storageBucket: "niyan-it-solutions.appspot.com",
    messagingSenderId: "635399322266",
    appId: "1:635399322266:web:c54d16872dca4a54fbfd23"
};
firebase.initializeApp(firebaseConfig);


/* ---------------- OTP + TIMER + RESEND BUTTON ---------------- */

let otpVerified = false;
let timerInterval;
let timeLeft = 30;

function startTimer() {
    timeLeft = 30;
    document.getElementById("timer").innerHTML = "Resend OTP in " + timeLeft + "s";

    timerInterval = setInterval(function () {
        timeLeft--;
        document.getElementById("timer").innerHTML = "Resend OTP in " + timeLeft + "s";

        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            document.getElementById("timer").innerHTML = "";
            document.getElementById("resendOtpBtn").style.display = "inline-block";
            document.getElementById("sendOtpBtn").disabled = false;
        }
    }, 1000);
}

function sendOTP() {
    let mobile = document.getElementById("mobile").value;

    if (mobile.length !== 10) {
        alert("Enter valid 10-digit mobile number");
        return;
    }

    var number = "+91" + mobile;

    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container');

    firebase.auth().signInWithPhoneNumber(number, window.recaptchaVerifier)
    .then(function (confirmationResult) {
        window.confirmationResult = confirmationResult;
        document.getElementById("otpStatus").innerHTML = "OTP Sent Successfully!";
        
        document.getElementById("sendOtpBtn").disabled = true;
        document.getElementById("resendOtpBtn").style.display = "none";

        startTimer();
    })
    .catch(function (error) {
        alert(error.message);
    });
}

function resendOTP() {
    document.getElementById("resendOtpBtn").style.display = "none";
    sendOTP(); // re-send
}

function verifyOTP() {
    let otp = document.getElementById("otpInput").value;

    confirmationResult.confirm(otp)
    .then(function () {
        otpVerified = true;
        clearInterval(timerInterval);
        document.getElementById("timer").innerHTML = "";
        document.getElementById("otpStatus").innerHTML = "OTP Verified ✔";
        document.getElementById("submitBtn").disabled = false;
    })
    .catch(function () {
        document.getElementById("otpStatus").innerHTML = "Invalid OTP ❌";
        otpVerified = false;
    });
}

/* ------------------ EMAILJS SEND ---------------------- */

emailjs.init("G5CrX0415IPB8S-e8");

window.onload = function() {
    openModal();
};

function openModal() {
    document.getElementById("contactModal").style.display = "flex";
}

function closeModal() {
    window.location.href = "index.html";
}

document.getElementById("quoteForm").addEventListener("submit", function(e) {
    e.preventDefault();

    if (!otpVerified) {
        alert("Please verify OTP before submitting!");
        return;
    }

    const serviceID = "service_zbqz15h";
    const templateID = "template_bnocmno";

    emailjs.sendForm(serviceID, templateID, this)
    .then(() => {
        document.getElementById("formBox").style.display = "none";
        document.getElementById("successBox").style.display = "block";

        setTimeout(() => {
            window.location.href = "index.html";
        }, 2000);
    })
    .catch((err) => {
        alert("Failed: " + JSON.stringify(err));
    });
});
</script>

</body>
</html>
